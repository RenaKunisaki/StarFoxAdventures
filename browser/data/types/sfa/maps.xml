<?xml version="1.0"?>
<?xml-model href="../types.xsd"?>
<types namespace="maps">
    <enum name="MapId16" type="s16">
        <item name="frontend" />
        <item name="frontend2" />
        <item name="dragrock" />
        <item name="krazoapalace" />
        <item name="temple" />
        <item name="hightop" />
        <item name="discovery" />
        <item name="hollow" />
        <item name="hollow2" />
        <item name="mazecave" />
        <item name="wastes" />
        <item name="warlock" />
        <item name="fortress" />
        <item name="wallcity" />
        <item name="swapcircle" />
        <item name="cloudtreasure" />
        <item name="clouddungeon" />
        <item name="cloudtrap" />
        <item name="moonpass" />
        <item name="snowmines" />
        <item name="krashrin2" />
        <item name="kraztest" />
        <item name="krazchamber" />
        <item name="newicemount" />
        <item name="newicemount2" />
        <item name="newicemount3" />
        <item name="animtest" />
        <item name="snowmines2" />
        <item name="snowmines3" />
        <item name="capeclaw" />
        <item name="insidegal" />
        <item name="dfshrine" />
        <item name="mmshrine" />
        <item name="ecshrine" />
        <item name="gpshrine" />
        <item name="diamondbay" />
        <item name="earthwalker" />
        <item name="willow" />
        <item name="arwing" />
        <item name="dbshrine" />
        <item name="nwshrine" />
        <item name="ccshrine" />
        <item name="wgshrine" />
        <item name="cloudrace" />
        <item name="finalboss" />
        <item name="wminsert" />
        <item name="snowmines4" />
        <item name="snowmines5" />
        <item name="trexboss" />
        <item name="mikelava" />
        <item name="dfptop" />
        <item name="swapstore" />
        <item name="dragbot" />
        <item name="kamdrag" />
        <item name="magicave" />
        <item name="duster" />
        <item name="linkb" />
        <item name="cloudjoin" />
        <item name="arwingtoplanet" />
        <item name="arwingdarkice" />
        <item name="arwingcloud" />
        <item name="arwingcity" />
        <item name="arwingdragon" />
        <item name="gamefront" />
        <item name="linklevel" />
        <item name="greatfox" />
        <item name="linka" />
        <item name="linkc" />
        <item name="linkd" />
        <item name="linke" />
        <item name="linkf" />
        <item name="linkg" />
        <item name="linkh" />
        <item name="linkj" />
        <item name="linki" />
        <item name="dfpodium" />
        <item name="dfcradle" />
        <item name="dfcavehatch1" />
        <item name="dfcavehatch2" />
        <item name="scstatue" />
        <item name="galleonship" />
        <item name="cfgalleon" />
        <item name="cfgangplank" />
        <item name="nwtreebridge" />
        <item name="cfdungeonblock" />
        <item name="cloudrunnermap" />
        <item name="ccbridge" />
        <item name="cfcolumn" />
        <item name="nwboulder" />
        <item name="cfprisondoor" />
        <item name="cfprisoncage" />
        <item name="nwtreebridge2" />
        <item name="dim2iceblock1" />
        <item name="dimpushblock" />
        <item name="dim2iceblock2" />
        <item name="dimhornplinth" />
        <item name="nwshcolpush" />
        <item name="dim2lift" />
        <item name="dim2icefloe" />
        <item name="dim2icefloe1" />
        <item name="dim2icefloe2" />
        <item name="cfliftplat" />
        <item name="imspacecraft" />
        <item name="dimbossgut" />
        <item name="wmcolrise" />
        <item name="vfpslide1" />
        <item name="vfpslide2" />
        <item name="drpushcart" />
        <item name="drliftplat" />
        <item name="dim2stonepillar" />
        <item name="bossdrakorflatr" />
        <item name="wcbouncycrate" />
        <item name="wcpushblock" />
        <item name="wctemplelift" />
        <item name="KamColumn" />
        <item name="dbstepstone" />
        <item name="vfppushblock" />
        <item name="NO_MAP" value="-1" />
    </enum>
    <enum name="MapDirIdx16" type="s16">
        <item name="animtest" />
        <item name="animtest_01" />
        <item name="animtest_02" />
        <item name="arwing" />
        <item name="dragrock" />
        <item name="animtest_05" />
        <item name="dfptop" />
        <item name="volcano" />
        <item name="animtest_08" />
        <item name="mazecave" />
        <item name="dragrockbot" />
        <item name="dfalls" />
        <item name="swaphol" />
        <item name="shipbattle" />
        <item name="nwastes" />
        <item name="warlock" />
        <item name="shop" />
        <item name="animtest_11" />
        <item name="crfort" />
        <item name="swapholbot" />
        <item name="wallcity" />
        <item name="lightfoot" />
        <item name="cloudtreasure" />
        <item name="animtest_17" />
        <item name="clouddungeon" />
        <item name="mmpass" />
        <item name="darkicemines" />
        <item name="animtest_1B" />
        <item name="desert" />
        <item name="animtest_1D" />
        <item name="icemountain" />
        <item name="animtest_1F" />
        <item name="animtest_20" />
        <item name="animtest_21" />
        <item name="darkicemines2" />
        <item name="bossgaldon" />
        <item name="animtest_24" />
        <item name="insidegal" />
        <item name="magiccave" />
        <item name="dfshrine" />
        <item name="mmshrine" />
        <item name="ecshrine" />
        <item name="gpshrine" />
        <item name="dbshrine" />
        <item name="nwshrine" />
        <item name="worldmap" />
        <item name="animtest_2E" />
        <item name="capeclaw" />
        <item name="dbay" />
        <item name="animtest_31" />
        <item name="cloudrace" />
        <item name="bossdrakor" />
        <item name="animtest_34" />
        <item name="bosstrex" />
        <item name="linkb" />
        <item name="cloudjoin" />
        <item name="arwingtoplanet" />
        <item name="arwingdarkice" />
        <item name="arwingcloud" />
        <item name="arwingcity" />
        <item name="arwingdragon" />
        <item name="gamefront" />
        <item name="linklevel" />
        <item name="greatfox" />
        <item name="linka" />
        <item name="linkc" />
        <item name="linkd" />
        <item name="linke" />
        <item name="linkf" />
        <item name="linkg" />
        <item name="linkh" />
        <item name="linkj" />
        <item name="linki" />
        <item name="NUM_MAPS" value="0x49" />
        <item name="NO_MAP" value="-1" />
    </enum>

    <struct name="RomListEntry">
        <description>Common header of romlist entries</description>
        <field name="objDef" type="ObjDefEnum" />
        <field name="length" type="u8">
            <description>Number of 4-byte words in this entry</description>
        </field>
        <field name="acts0" type="u8" />
        <field name="loadFlags" type="u8" />
        <field name="acts1" type="u8" />
        <field name="bound" type="u8" />
        <field name="cullDist" type="u8" />
        <field name="position" type="vec3f" />
        <field name="id" type="ObjUniqueId">
            <description>Globally unique ID of this object</description>
        </field>
        <!-- following this is object-specific params -->
    </struct>

    <struct name="MapsBinEntry0">
        <description>Entry in MAPS.bin referenced by MapsTabEntry.info</description>
        <field name="sizeX" type="s16" />
        <field name="sizeZ" type="s16" />
        <field name="originX" type="s16" />
        <field name="originZ" type="s16" />
        <field name="unk08" type="u32" />
        <field name="unk0C" type="u32" count="4">
            <note>rect related? 4 of these, 4 of those...</note>
        </field>
        <field name="nBlocks" type="s16" />
        <field name="unk1E" type="u16">
            <description>possibly flags</description>
        </field>
    </struct>

    <struct name="MapsTabEntry">
        <description>Entry in MAPS.tab</description>
        <field name="info" type="u32">
            <description>offset of MapsBinEntry0</description>
        </field>
        <field name="blocks" type="u32">
            <description>offset of u32[] (block data)</description>
        </field>
        <field name="rects" type="u32" count="4">
            <description>offsets of some rect data</description>
        </field>
        <field name="romList" type="u32">
            <description>offset of a FACEFEED header</description>
            <note>In old versions this points to the actual list.
                In the final version this points to a FACEFEED header
                with no data following (the data is in a separate file);
                its size tells how much memory to allocate.
                The final will still load a list from here if there is
                no external file. (TODO check for maps that have old
                lists here.)
            </note>
        </field>
    </struct>

    <struct name="MapInfoEntry">
        <description>Entry in MAPINFO.bin</description>
        <field name="name" type="string" count="28">
            <description>Map name displayed in debug menus</description>
        </field>
        <field name="type" type="u8">
            <description>Map type</description>
        </field>
        <field name="unk1D" type="u8">
            <description>Always 6</description>
        </field>
        <field name="objType" type="ObjDefEnum">
            <description>If not zero, use this object type as the player. Not used in final version.</description>
        </field>
    </struct>

    <struct name="MapGridItem">
        <description>Entry in globalma.bin</description>
        <field name="x" type="s16">
            <description>Global X coord</description>
        </field>
        <field name="z" type="s16">
            <description>Global Z coord</description>
        </field>
        <field name="layer" type="s16">
            <description>Layer ID (-2 to 2)</description>
        </field>
        <field name="mapId" type="MapId16">
            <description>Which map this is</description>
        </field>
        <field name="link" type="s16" count="2">
            <description>Linked map IDs</description>
        </field>
    </struct>

    <struct name="WarpTabEntry">
        <field name="pos" type="vec3f" />
        <field name="layer" type="s16" />
        <field name="xRot" type="s16" />
    </struct>

    <enum name="WarpId" type="u8">
        <note>Names made up</note>
        <item value="0x00" name="CR_Dungeon" />
        <item value="0x02" name="IM_Teleporter" />
        <item value="0x03" name="TTH_EggCave" />
        <item value="0x06" name="KP_Top" />
        <item value="0x0C" name="CR_Dungeon0C">
            <note>Same as 0x00</note>
        </item>
        <item value="0x0F" name="TTH_WarpStone" />
        <item value="0x10" name="MMP_MagicCave" />
        <item value="0x12" name="TitleScreen" />
        <item value="0x13" name="WC_FrontOfPyramid" />
        <item value="0x15" name="WC_MagicCave" />
        <item value="0x1A" name="IM_Top" />
        <item value="0x1D" name="Boss_Galdon" />
        <item value="0x1E" name="Boss_Galdon1E" />
        <item value="0x20" name="KP_WarpStonePad" />
        <item value="0x22" name="KP_InnerWarp" />
        <item value="0x24" name="dfshrine" />
        <item value="0x25" name="nwshrine" />
        <item value="0x26" name="dbshrine" />
        <item value="0x28" name="KP_InnerWarp2" />
        <item value="0x2A" name="WC_2A" />
        <item value="0x2B" name="mmshrine" />
        <item value="0x32" name="Boss_Andross" />
        <item value="0x33" name="MazeCave" />
        <item value="0x34" name="TTH_BombSporeCave" />
        <item value="0x35" name="CC_MagicCave" />
        <item value="0x36" name="Boss_Galdon36" />
        <item value="0x40" name="MMP_EndWarp" />
        <item value="0x41" name="KP_FinalBossWarp" />
        <item value="0x42" name="NW_ShrineWarp" />
        <item value="0x44" name="ecshrine" />
        <item value="0x46" name="WC_Top" />
        <item value="0x47" name="LV_ShrineWarp" />
        <item value="0x48" name="Volcano" />
        <item value="0x49" name="CRF_Race" />
        <item value="0x4A" name="CRF_4A" />
        <item value="0x4B" name="desert4B" />
        <item value="0x4C" name="desert4C" />
        <item value="0x4E" name="KP_LandingPad" />
        <item value="0x50" name="LV_Plateau" />
        <item value="0x51" name="VFP_SpellStoneSeal" />
        <item value="0x53" name="dragrockbot" />
        <item value="0x54" name="Boss_Drakor" />
        <item value="0x55" name="LV_OutOfBounds" />
        <item value="0x57" name="MagicCave" />
        <item value="0x5A" name="Boss_Trex" />
        <item value="0x5B" name="WC_BossEntrance" />
        <item value="0x5C" name="Boss_Galdon5C" />
        <item value="0x5D" name="OldKP_5D" />
        <item value="0x5E" name="OldKP_5E" />
        <item value="0x5F" name="TTH_Bottom" />
        <item value="0x60" name="WorldMap" />
        <item value="0x63" name="CRF_LandingPad" />
        <item value="0x66" name="TTH_MagicCave" />
        <item value="0x67" name="NW_MagicCave" />
        <item value="0x68" name="OFP_Top" />
        <item value="0x69" name="desert69" />
        <item value="0x6C" name="TTH_LandingPad" />
        <item value="0x6D" name="Boss_Trex6D" />
        <item value="0x6E" name="Arwing_ToCRF" />
        <item value="0x6F" name="Arwing_ToTTH" />
        <item value="0x71" name="desert71" />
        <item value="0x72" name="desert72" />
        <item value="0x73" name="OFP_73" />
        <item value="0x74" name="Arwing_ToDIM" />
        <item value="0x75" name="Arwing_ToDR" />
        <item value="0x76" name="Arwing_ToWC" />
        <item value="0x77" name="DIM_LandingPad" />
        <item value="0x78" name="WC_LandingPad" />
        <item value="0x79" name="DR_LandingPad" />
        <item value="0x7A" name="VFP_Centre" />
        <item value="0x7B" name="VFP_SpellStonePillar" />
        <item value="0x7C" name="VFP_7C" />
        <item value="0x7E" name="WarpStoneLink" />
        <item value="0x7F" name="GreatFox" />
    </enum>

    <struct name="GCPolygon">
        <field type="u16" count="3" name="vtxs">
            <description>Indices into block.vtxPositions</description>
        </field>
        <field type="u16" />
    </struct>

    <struct name="PolygonGroup">
        <!-- this field seems wrong since I see 0, 0, 640 -->
        <field type="ushort" name="firstPolygon" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="short" />
        <field type="short" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="uint" name="flags">
            <note>(val &gt;&gt; 16) &amp; 0xFF is something else</note>
        </field>
        <field type="ushort" />
    </struct>

    <struct name="DisplayListPtr">
        <field type="pointer" name="list">
            <note>points to GX dlist commands</note>
        </field>
        <field type="ushort" name="size" />
        <field type="vec3s" count="2" name="bbox" />
        <field type="undefined" />
        <field type="u8" name="shaderId" />
        <field type="u16" name="specialBitAddr">
            <description>offset relating to shaders</description>
        </field>
        <field type="u16">
            <note>offset of some sort</note>
        </field>
        <field type="u32">
            <note>always 07 00 00 00? XXX verify size</note>
        </field>
    </struct>

    <struct name="LineHit">
        <!-- XXX same as HitsBinEntry? -->
        <field type="short" />
        <field type="short" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="short" />
        <field type="short" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="u8" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
    </struct>

    <struct name="HitsBinEntry">
        <field type="short">
            <note>pos or size, range 0-640</note>
        </field>
        <field type="short" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="short" />
        <field type="short" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="u8" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
    </struct>

    <struct name="ShaderLayer">
        <field type="u32" name="texture" />
        <field type="u8" name="tevMode" />
        <field type="u8" name="enableTexChainStuff" />
        <field type="u8" name="scrollingTexMtx" />
        <field type="undefined" />
    </struct>

    <struct name="Shader">
        <field type="undefined" /><!-- 00 -->
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="u8" name="r" /><!-- 04 -->
        <field type="u8" name="g" />
        <field type="u8" name="b" />
        <field type="undefined" />
        <field type="pointer" name="auxTex0" /><!-- 08 -->
        <field type="u8" name="alpha" /><!-- 0C -->
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" /><!-- 10 -->
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="pointer" name="auxTex1" /><!-- 14 -->
        <field type="pointer" name="texture18" /><!-- 18 -->
        <field type="int"><!-- 1C -->
            <note>-1 -&gt; 0, -2 -&gt; 0, else -&gt; 1</note>
        </field>
        <field type="pointer" /><!-- 20 -->
        <field type="ShaderLayer" count="2" name="layer" /><!-- 24 -->
        <field type="pointer" name="auxTex2" /><!-- 34 -->
        <field type="pointer" name="furTexture" /><!-- 38 -->
        <field type="u32" name="flags"><!-- 3C ShaderFlags -->
            <note>may be from beta</note>
            <!--
                DevGeometry	0x2
                Fog	0x4
                CullBackface	0x8
                ReflectSkyscape	0x20
                Caustic	0x40
                Lava	0x80
                Reflective	0x100
                FuzzRelated	0x200
                AlphaCompare	0x400
                ShortFur	0x4000
                MediumFur	0x8000
                LongFur	0x10000
                StreamingVideo	0x20000
                IndoorOutdoorBlend	0x40000
                ForceBlend	0x40000000
                Water	0x80000000
            -->
        </field>
        <field type="u8" name="attrFlags" /><!-- 40 ShaderAttrFlags -->
        <field type="s8" name="nLayers" /><!-- 41 -->
        <padding count="2" /><!-- 42 -->
    </struct>

    <struct name="MapBlock">
        <field type="u32" name="unused00">
            <note>set from 80060b90 - XXX confirm unused</note>
        </field>
        <field type="ushort" name="flags_0x4">
            <note>40=need init hits? 1=toggled on render</note>
        </field>
        <field type="undefined" />
        <field type="undefined" />
        <field type="int" name="length">
            <description>file size</description>
        </field>
        <field type="Mtx43" name="mtx" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="pointer" name="GCpolygons" />
        <field type="pointer" name="polygonGroups" />
        <field type="pointer" name="textures">
            <description>pointer to texture IDs which get changed to pointers</description>
        </field>
        <field type="pointer" name="vertexPositions">
            <note>vec3s*</note>
        </field>
        <field type="pointer" name="vertexColors" />
        <field type="pointer" name="vertexTexCoords">
            <note>vec2s*</note>
        </field>
        <field type="pointer" name="shaders">
            <note>Shader*</note>
        </field>
        <field type="pointer" name="displayLists">
            <note>DisplayListPtr*</note>
        </field>
        <field type="pointer" name="linehits">
            <note>LineHit*</note>
        </field>
        <field type="pointer" name="hits">
            <note>HitsBinEntry*</note>
            <note>data from HITS.bin, size from HITS.tab; 0 in file</note>
        </field>
        <field type="undefined4">
            <note>set to 0 in initHits</note>
        </field>
        <field type="pointer" name="renderInstrsMain">
            <note>BitStream*</note>
        </field>
        <field type="pointer" name="renderInstrsReflective" />
        <field type="pointer" name="renderInstrsWater" />
        <field type="u16" name="nRenderInstrsMain" />
        <field type="u16" name="nRenderInstrsReflective" />
        <field type="u16" name="nRenderInstrsWater" />
        <field type="short" name="yMin">
            <note>related to bounds</note>
        </field>
        <field type="short" name="yMax" />
        <field type="short" name="yOffset" />
        <field type="u16" name="nVtxs" />
        <field type="u16" name="nUnk" /><!-- most likely u16 n??? -->
        <field type="u16" name="nColors" />
        <field type="u16" name="nTexCoords" />
        <field type="u16" name="nPolygons" />
        <field type="u16" name="nPolyGroups" />
        <field type="u16" name="nHits" />
        <field type="undefined2" name="hitField_9e">
            <note>set to 0 in initHits</note>
        </field>
        <field type="u8" name="nTextures" />
        <field type="u8" name="nDlists" />
        <field type="u8" name="nShaders" />
        <field type="u8" />
        <field type="string" count="11" name="name">
            <note>size guessed from OBJECTS.bin</note>
        </field>
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
        <field type="undefined" />
    </struct>
</types>
